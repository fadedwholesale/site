<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug RealTime Sync Error</title>
    <style>
        body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
        .error { color: #f00; font-weight: bold; }
        .success { color: #0f0; font-weight: bold; }
        .warning { color: #fa0; font-weight: bold; }
        .log { margin: 2px 0; }
    </style>
</head>
<body>
    <h1>RealTime Sync Error Debug</h1>
    <p>Monitoring for the specific error: "TypeError: window.sharedDataManager.getData is not a function"</p>
    <div id="status">Loading...</div>
    <div id="logs"></div>

    <!-- Load scripts in same order as main portal -->
    <script src="firebase-integration-bridge.js"></script>
    <script src="realtime-sync.js"></script>
    <script src="shared-data.js"></script>

    <script>
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');
        let errorOccurred = false;

        function addLog(type, message) {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<span style="color: #666">[${new Date().toLocaleTimeString()}]</span> ${message}`;
            logsDiv.appendChild(div);
            logsDiv.scrollTop = logsDiv.scrollHeight;
            
            if (type === 'error' && message.includes('getData is not a function')) {
                errorOccurred = true;
                statusDiv.innerHTML = '<span class="error">‚ùå TARGET ERROR DETECTED!</span>';
            }
        }

        // Override console methods
        const originalError = console.error;
        const originalWarn = console.warn;
        const originalLog = console.log;

        console.error = (...args) => {
            originalError(...args);
            addLog('error', args.join(' '));
        };

        console.warn = (...args) => {
            originalWarn(...args);
            addLog('warning', args.join(' '));
        };

        console.log = (...args) => {
            const message = args.join(' ');
            originalLog(...args);
            if (message.includes('SharedDataManager') || message.includes('RealTime') || message.includes('sync')) {
                addLog('success', message);
            }
        };

        // Monitor window.onerror for uncaught errors
        window.onerror = function(message, source, lineno, colno, error) {
            addLog('error', `Uncaught Error: ${message} at ${source}:${lineno}:${colno}`);
            if (message.includes('getData is not a function')) {
                errorOccurred = true;
                statusDiv.innerHTML = '<span class="error">‚ùå TARGET ERROR DETECTED VIA WINDOW.ONERROR!</span>';
            }
        };

        // Status updates
        let checkCount = 0;
        const statusChecker = setInterval(() => {
            checkCount++;
            
            const sdmExists = !!window.sharedDataManager;
            const sdmHasGetData = sdmExists && typeof window.sharedDataManager.getData === 'function';
            const rtsExists = !!window.realTimeSync;
            const rtsReady = rtsExists && window.realTimeSync.isSharedDataManagerReady;

            let status = `Check #${checkCount}: `;
            if (!errorOccurred) {
                status += '<span class="success">‚úÖ No target error detected</span><br>';
            } else {
                status += '<span class="error">‚ùå Target error detected!</span><br>';
            }
            
            status += `SharedDataManager: ${sdmExists ? '‚úÖ' : '‚ùå'} exists, ${sdmHasGetData ? '‚úÖ' : '‚ùå'} has getData<br>`;
            status += `RealTimeSync: ${rtsExists ? '‚úÖ' : '‚ùå'} exists, ${rtsReady ? '‚úÖ' : '‚ùå'} ready<br>`;
            
            statusDiv.innerHTML = status;

            if (checkCount > 60) { // Stop after 60 checks (5 minutes)
                clearInterval(statusChecker);
                if (!errorOccurred) {
                    statusDiv.innerHTML += '<br><span class="success">üéâ SUCCESS: No errors detected in 5 minutes!</span>';
                }
            }
        }, 5000);

        addLog('success', 'Debug page loaded, monitoring for errors...');
    </script>
</body>
</html>
