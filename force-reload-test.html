<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Force Reload Test</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        .error { color: #f00; }
        .success { color: #0f0; }
        .warning { color: #fa0; }
    </style>
</head>
<body>
    <h1>Force Reload Test</h1>
    <p>This page forces fresh script loading with timestamps</p>
    <div id="log"></div>

    <script>
        const logDiv = document.getElementById('log');
        const timestamp = Date.now();
        
        function log(type, message) {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(div);
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = `${src}?t=${timestamp}&r=${Math.random()}`;
                script.onload = () => {
                    log('success', `✅ Loaded: ${src}`);
                    resolve();
                };
                script.onerror = () => {
                    log('error', `❌ Failed to load: ${src}`);
                    reject(new Error(`Failed to load ${src}`));
                };
                document.head.appendChild(script);
            });
        }

        async function loadScripts() {
            try {
                log('success', 'Starting script loading...');
                
                await loadScript('firebase-integration-bridge.js');
                await loadScript('shared-data.js');
                
                log('success', 'All scripts loaded, waiting for initialization...');
                
                // Wait a bit for initialization
                setTimeout(() => {
                    if (window.sharedDataManager) {
                        if (typeof window.sharedDataManager.getData === 'function') {
                            log('success', '🎉 SUCCESS: sharedDataManager.getData is available!');
                            
                            // Test it
                            window.sharedDataManager.getData()
                                .then(data => log('success', '✅ getData() call successful'))
                                .catch(error => log('error', `❌ getData() failed: ${error.message}`));
                        } else {
                            log('error', '❌ sharedDataManager exists but getData is not a function');
                            log('error', `Type: ${typeof window.sharedDataManager.getData}`);
                        }
                    } else {
                        log('error', '❌ sharedDataManager not available');
                    }
                }, 3000);
                
            } catch (error) {
                log('error', `Script loading failed: ${error.message}`);
            }
        }

        // Monitor for the specific error
        const originalError = console.error;
        console.error = (...args) => {
            originalError(...args);
            const message = args.join(' ');
            if (message.includes('getData is not a function')) {
                log('error', `🚨 TARGET ERROR DETECTED: ${message}`);
            }
        };

        loadScripts();
    </script>
</body>
</html>
