# Faded Skies Portal - Data Connect Queries
# Real-time data queries for dynamic portal functionality

# User Management Queries
query GetUser($id: String!) {
  user(id: $id) {
    id
    email
    role
    companyName
    contactName
    phone
    address
    licenseNumber
    status
    createdAt
    updatedAt
    lastLogin
    verificationDocuments
  }
}

query GetUsers($role: String, $status: String) {
  users(where: {
    role: $role,
    status: $status
  }) {
    id
    email
    role
    companyName
    contactName
    phone
    status
    createdAt
    lastLogin
  }
}

query GetPendingPartners {
  users(where: {
    role: "partner",
    status: "pending"
  }) {
    id
    email
    companyName
    contactName
    phone
    licenseNumber
    createdAt
  }
}

# Product Management Queries
query GetProducts($category: String, $status: String) {
  products(where: {
    category: $category,
    status: $status
  }) {
    id
    name
    description
    category
    subcategory
    thcContent
    cbdContent
    price
    wholesalePrice
    stockQuantity
    minOrderQuantity
    maxOrderQuantity
    status
    images
    labResults
    createdAt
    updatedAt
  }
}

query GetProduct($id: UUID!) {
  product(id: $id) {
    id
    name
    description
    category
    subcategory
    thcContent
    cbdContent
    price
    wholesalePrice
    stockQuantity
    minOrderQuantity
    maxOrderQuantity
    status
    images
    labResults
    createdAt
    updatedAt
    createdBy
  }
}

query GetLowStockProducts($threshold: Int!) {
  products(where: {
    stockQuantity: { _lte: $threshold },
    status: "active"
  }) {
    id
    name
    stockQuantity
    wholesalePrice
  }
}

# Order Management Queries
query GetOrders($partnerId: String, $status: String) {
  orders(where: {
    partnerId: $partnerId,
    status: $status
  }) {
    id
    orderNumber
    partnerId
    partner {
      companyName
      contactName
      email
    }
    status
    totalAmount
    subtotal
    tax
    shipping
    notes
    shippingAddress
    billingAddress
    createdAt
    updatedAt
    estimatedDelivery
    actualDelivery
    trackingNumber
  }
}

query GetOrder($id: UUID!) {
  order(id: $id) {
    id
    orderNumber
    partnerId
    partner {
      id
      companyName
      contactName
      email
      phone
    }
    status
    totalAmount
    subtotal
    tax
    shipping
    notes
    shippingAddress
    billingAddress
    createdAt
    updatedAt
    estimatedDelivery
    actualDelivery
    trackingNumber
    orderItems {
      id
      productId
      product {
        name
        description
        images
      }
      quantity
      unitPrice
      totalPrice
      notes
    }
  }
}

query GetRecentOrders($limit: Int!) {
  orders(orderBy: { createdAt: DESC }, limit: $limit) {
    id
    orderNumber
    partnerId
    partner {
      companyName
    }
    status
    totalAmount
    createdAt
  }
}

# Notification Queries
query GetNotifications($userId: String!, $read: Boolean) {
  notifications(where: {
    userId: $userId,
    read: $read
  }, orderBy: { createdAt: DESC }) {
    id
    type
    title
    message
    read
    createdAt
    data
  }
}

query GetUnreadNotificationCount($userId: String!) {
  notifications(where: {
    userId: $userId,
    read: false
  }) {
    id
  }
}

# Inventory Management Queries
query GetInventoryTransactions($productId: UUID, $type: String) {
  inventoryTransactions(where: {
    productId: $productId,
    type: $type
  }, orderBy: { createdAt: DESC }) {
    id
    productId
    product {
      name
    }
    type
    quantity
    previousStock
    newStock
    reason
    orderId
    createdBy
    createdAt
  }
}

query GetProductStockHistory($productId: UUID!) {
  inventoryTransactions(where: {
    productId: $productId
  }, orderBy: { createdAt: DESC }) {
    id
    type
    quantity
    previousStock
    newStock
    reason
    createdAt
  }
}

# Audit and Analytics Queries
query GetAuditLogs($userId: String, $table: String, $limit: Int!) {
  auditLogs(where: {
    userId: $userId,
    table: $table
  }, orderBy: { createdAt: DESC }, limit: $limit) {
    id
    userId
    user {
      email
      companyName
    }
    action
    table
    recordId
    oldValues
    newValues
    ipAddress
    createdAt
  }
}

query GetSystemStats {
  # Get total counts for dashboard
  users(where: { role: "partner" }) {
    id
    status
  }
  products(where: { status: "active" }) {
    id
    stockQuantity
  }
  orders(where: { status: "pending" }) {
    id
    totalAmount
  }
}

# Partner Document Queries
query GetPartnerDocuments($partnerId: String!) {
  partnerDocuments(where: {
    partnerId: $partnerId
  }) {
    id
    documentType
    fileName
    fileUrl
    status
    reviewedBy
    reviewNotes
    uploadedAt
    reviewedAt
  }
}

query GetPendingDocuments {
  partnerDocuments(where: {
    status: "pending"
  }) {
    id
    partnerId
    partner {
      companyName
      contactName
      email
    }
    documentType
    fileName
    uploadedAt
  }
}

# System Configuration Queries
query GetSystemConfig($id: String!) {
  systemConfig(id: $id) {
    id
    value
    description
    updatedBy
    updatedAt
  }
}

query GetAllSystemConfigs {
  systemConfigs {
    id
    value
    description
    updatedAt
  }
}
